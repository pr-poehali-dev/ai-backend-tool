# Встраиваемые чат-виджеты

## Описание
Система создания и управления встраиваемыми чат-виджетами для веб-сайтов. Позволяет создавать настраиваемые чаты с AI-ассистентами и встраивать их на любой сайт.

## Возможности

### Создание чатов
- Название чата
- Выбор AI-ассистента для обработки сообщений
- Конфигуратор внешнего вида
- Генерация готового кода для встраивания

### Настройки внешнего вида

#### Позиционирование
- Справа внизу (по умолчанию)
- Слева внизу
- Справа вверху
- Слева вверху

#### Темы
- Светлая
- Тёмная
- Автоматическая (по системным настройкам)

#### Настройки цвета и формы
- Основной цвет (с выбором через color picker)
- Скругление углов (px)
- Ширина чата (px, по умолчанию 400)
- Высота чата (px, по умолчанию 600)

#### Аватар
- Включить/выключить аватар
- URL изображения аватара

#### Отображение времени
- Показывать/скрывать время сообщений

### Настройки сообщений
- Приветственное сообщение
- Placeholder поля ввода
- Текст кнопки открытия чата
- Иконка кнопки (emoji)

### Поведение
- Автоматическое открытие при загрузке страницы
- Задержка автооткрытия (мс)

## Использование

### 1. Создание чата
1. Перейдите на вкладку "Чаты"
2. Нажмите "Создать чат"
3. Заполните название
4. Выберите ассистента (обязательно!)
5. Настройте внешний вид и поведение
6. Нажмите "Создать"

### 2. Встраивание на сайт
1. Скопируйте сгенерированный код чата
2. Вставьте код перед закрывающим тегом `</body>` на вашем сайте
3. Чат автоматически появится на странице

### 3. Редактирование
1. Нажмите кнопку "Настроить" (шестерёнка) у нужного чата
2. Внесите изменения
3. Нажмите "Сохранить"
4. Обновите код на сайте (если изменились настройки)

### 4. Предпросмотр
- Нажмите кнопку "Предпросмотр" (глаз) чтобы увидеть как выглядит чат
- Протестируйте интерфейс перед встраиванием

### 5. Удаление
- Нажмите кнопку "Удалить" (корзина)
- Подтвердите удаление

## Технические детали

### Хранение данных
- Чаты хранятся в LocalStorage браузера
- Данные сохраняются автоматически при создании/изменении
- Миграция базы данных подготовлена для будущего бэкенда

### Структура чата
```typescript
interface Chat {
  id: string;                // Уникальный ID
  name: string;              // Название
  config: ChatConfig;        // Конфигурация
  code: string;              // Embed-код
  created_at: string;        // Дата создания
}

interface ChatConfig {
  position: 'bottom-right' | 'bottom-left' | 'top-right' | 'top-left';
  theme: 'light' | 'dark' | 'auto';
  primaryColor: string;      // HEX цвет
  assistantId: string;       // ID ассистента
  welcomeMessage: string;
  placeholder: string;
  buttonText: string;
  buttonIcon: string;        // Emoji
  width: number;             // px
  height: number;            // px
  borderRadius: number;      // px
  showAvatar: boolean;
  avatarUrl?: string;
  showTimestamp: boolean;
  autoOpen: boolean;
  autoOpenDelay: number;     // ms
}
```

### Генерируемый код
Система генерирует самодостаточный JavaScript-код, который:
- Создаёт стили для виджета
- Добавляет HTML-разметку чата
- Настраивает обработчики событий
- Применяет все заданные параметры
- Интегрирует API для общения с AI-ассистентом

## AI-интеграция ✨

### Как работает
- Чат использует выбранного AI-ассистента для ответов
- Сообщения отправляются на GPTunnel API
- Ассистент обрабатывает запрос и возвращает ответ
- Ответ отображается в чате в реальном времени
- Индикатор набора текста показывается во время обработки

### Тестирование
- В **предпросмотре** чата можно отправлять реальные сообщения
- Ответы приходят от настроенного ассистента
- Полностью функциональный чат для тестирования

### На встроенном сайте
- Посетители сайта могут общаться с AI-ассистентом
- Все сообщения обрабатываются через ваш выбранный ассистент
- Плавная анимация набора текста
- Обработка ошибок соединения

## Будущие улучшения
- Подключение к бэкенду для хранения истории чатов
- Статистика использования чатов (количество сообщений, популярные вопросы)
- Дополнительные темы оформления
- Кастомизация цветов сообщений
- Поддержка файлов и изображений
- Webhooks для уведомлений о новых сообщениях
- Экспорт истории переписки